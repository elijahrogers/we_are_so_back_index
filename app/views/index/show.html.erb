Today's prognosis: <%= @metric.value %> (<%= metric_value_description(@metric.value) %>)

<div
  data-controller="index-gauge"
  data-index-gauge-value-value="<%= @metric.value.to_f %>"
  data-index-gauge-min-value="-20"
  data-index-gauge-max-value="20"
  data-index-gauge-segments-value='[
    {"label":"Very Bearish","weight":25,"color":"#ef4444"},
    {"label":"Bearish","weight":25,"color":"#f59e0b"},
    {"label":"Neutral","weight":20,"color":"#9ca3af"},
    {"label":"Bullish","weight":15,"color":"#22c55e"},
    {"label":"Very Bullish","weight":15,"color":"#16a34a"}
  ]'
  class="max-w-sm mx-auto my-6">
  <svg data-index-gauge-target="svg" class="w-full h-auto"></svg>
</div>

<ul>
  <li>Bottom half advancers: <%= @metric.bottom_half_advancers %></li>
  <li>VIX percentile: <%= @metric.vix_percentile %></li>
  <li>NDX change 30d: <%= @metric.ndx_change_30d %></li>
  <li>BTC change 30d: <%= @metric.btc_change_30d %></li>
</ul>

<% sorted = @metrics.sort_by(&:date) %>
<div
  data-controller="metric-chart"
  data-metric-chart-labels-value='<%= sorted.map { |m| m.date.to_s }.to_json %>'
  data-metric-chart-datasets-value='<%= [
    { label: "Metric", data: sorted.map { |m| m.value.to_f } },
    { label: "Bottom half", data: sorted.map { |m| m.bottom_half_value.to_f } },
    { label: "VIX", data: sorted.map { |m| m.vix_value.to_f } },
    { label: "NDX", data: sorted.map { |m| m.ndx_value.to_f } },
    { label: "BTC", data: sorted.map { |m| m.btc_value.to_f } }
  ].to_json %>'
  class="w-full my-4">
  <div class="w-full h-64">
    <canvas data-metric-chart-target="canvas" class="w-full h-full"></canvas>
  </div>
</div>
